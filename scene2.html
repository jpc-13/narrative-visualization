<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scene 2</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body onload="init()" style="background-color: #f5f5f5; font-family: sans-serif;">
     <div style="height: 100px; padding: 20px; text-align: center;">
        <h1>Wealth and Health Across the World</h1>
        <h3>An interactive slideshow exploring how wealth relates to well-being</h3>
    </div>
    <div id="tooltip" style="opacity:0; position:absolute; border:1px solid black; background:white; padding: 3px"></div>
    <div style="display: flex; justify-content: center;">
        <svg width="750" height="500"></svg>
    </div>
    <div style="height: 150px; padding: 20px; text-align: center;">
        <p>This chart shows the relationship between GDP per capita and physicians per 1,000.</p>
        <p>Hover over data points to see the exact physicians per 1,000, GDP per capita, and country.</p>
        <p>GDP per capita does not as strongly correlate with physicians per 1,000. The country with the highest physician rate has less than $10,000 GDP per capita. But, majority of countries with physician count less than 1 per 1,000 have less than $10,000 GDP per capita.</p>
        <p>Click 'Next Scene' for the next measure.</p>
    </div>
     <div style="display: flex; justify-content: center; gap: 3px">
        <button style="
            padding: 10px;
            background-color: #327fcc;
            color: white;
            border: none;
            font-size: 12px;
            width: 120px
            "onclick="location.href='index.html'">Previous Scene
        </button>
         <div style="display: flex; justify-content: center;">
        <button style="
            padding: 10px;
            background-color: #327fcc;
            color: white;
            border: none;
            font-size: 12px;
            width: 120px
            "onclick="location.href='scene3.html'">Next Scene
        </button>
    </div>
    <div id="tooltip" style="opacity:0; position:absolute"></div>
    <script>
    async function init() {
        const data = await d3.csv("cleaned_data.csv");
        const mappedData = data
            .map(d => ({
                country: d["Country"],
                physicians: d["Physicians Per Thousand"],
                gdpPerCapita: d["GDP"] / d["Population"]
            }))
        
        const marg = 50;
        const width = 750 - (2 * marg);
        const height = 500 - (2 * marg);

        const x = d3.scaleLinear()
            .domain([0, 120000])
            .range([0, width]);

        const y = d3.scaleLinear()
            .domain([0, 9])
            .range([height, 0]);

        const svg = d3.select("svg")
            .append("g")
            .attr("transform", `translate(${marg},${marg})`);

        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x));

        svg.append("g")
            .call(d3.axisLeft(y));

        const tooltip = d3.select("#tooltip");

        const top20 = mappedData
            .sort((a, b) => b.gdpPerCapita - a.gdpPerCapita)
            .slice(0, 20)
            .map(d => d.country);

        svg.selectAll("circle")
            .data(mappedData)
            .enter()
            .append("circle")
            .attr("cx", d => x(d.gdpPerCapita))
            .attr("cy", d => y(d.physicians))
            .attr("r", 6)
            .attr("fill", d => top20.includes(d.country) ? "green" : "grey")
            .attr("stroke", "black")
            .on("mouseover", function(d, i) {
                 tooltip
                    .style("opacity", 1)
                    .style("left", (d3.event.pageX + 20) + "px")
                    .style("top", (d3.event.pageY + 20) + "px")
                    .html(
                        `Country: ${d.country}<br/>` +
                        `GDP per Capita: $${Math.round(d.gdpPerCapita)}<br/>` +
                        `Physicians per 1000: ${d.physicians}`
            );
            })
            .on("mouseout", function() { tooltip.style("opacity", 0); });

        svg.append("text")
            .attr("text-anchor", "middle")
            .attr("x", width / 2)
            .attr("y", height + 40)
            .text("GDP per Capita ($)");

        svg.append("text")
            .attr("text-anchor", "middle")
            .attr("transform", `rotate(-90)`)
            .attr("x", -height / 2)
            .attr("y", -30)
            .text("Physicians per 1,000");

        svg.append("text")
            .attr("x", width / 2)
            .attr("y", -20)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text("Scene 2 - Physicians per 1,000 vs GDP per Capita in 2023");

        svg.append("text")
            .attr("x", width)
            .attr("y", height / 3 + 10)
            .attr("text-anchor", "end")
            .attr("fill", "green")
            .style("font-size", "14px")
            .text("Green - Top 20 countries by GDP per capita");

        svg.append("rect")
            .attr("x", 0)       
            .attr("y", height - 45)      
            .attr("width", 55)
            .attr("height", 45)
            .attr("fill", "none")
            .attr("stroke", "red")
            .attr("stroke-dasharray", "4");
        
        svg.append("text")
            .attr("x", 65)
            .attr("y", height - 8)
            .attr("fill", "red")
            .style("font-size", "14px")
            .text("77/80 (96%) of countries with < 1 physician per 1,000 have < $10,000 GDP per capita");

        svg.append("text")
            .attr("x", 60)
            .attr("y", 29)
            .attr("fill", "grey")
            .style("font-size", "14px")
            .text("Cuba has the most physicians per 1,000 with < $10,000 GDP per capita");
    }
    </script>
</body>
</html>
